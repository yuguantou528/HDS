# 应急指挥调度系统产品需求文档

## 1. 项目概述

### 1.1 项目背景
应急指挥调度系统（HDS - Hazard Dispatch System）是一套基于现代Web技术构建的综合性应急通信指挥平台，旨在为应急管理部门、公安系统、消防救援、医疗急救等机构提供统一的音视频调度、会商协调和指挥管理能力。

系统采用B/S架构设计，支持跨平台部署，能够在紧急情况下快速响应，实现多部门协同作战，提高应急处置效率。

### 1.2 项目目标
- **统一指挥平台**: 构建统一的应急指挥调度平台，整合多种通信资源
- **多媒体通信**: 实现音频、视频、数据等多媒体通信调度功能
- **实时会商协作**: 提供实时音视频会商能力，支持远程协作决策
- **完整存储回放**: 建立完善的录音录像存储和回放系统，便于事后分析
- **权限安全管控**: 支持多级权限管理和用户认证，确保系统安全
- **大屏可视化**: 支持大屏显示和可视化展示，适应指挥中心环境
- **移动端适配**: 响应式设计，支持移动设备访问

### 1.3 技术架构

#### 1.3.1 前端技术栈
- **前端框架**: Vue 3.3+ (Composition API)
- **开发语言**: TypeScript 5.0+
- **构建工具**: Vite 4.0+
- **UI组件库**: Element Plus 2.4+
- **状态管理**: Pinia 2.1+
- **路由管理**: Vue Router 4.2+
- **HTTP客户端**: Axios
- **实时通信**: WebSocket + WebRTC
- **数据可视化**: ECharts 5.4+
- **样式预处理**: SCSS
- **代码规范**: ESLint + Prettier

#### 1.3.2 后端技术栈（规划）
- **后端框架**: Node.js + Express / Spring Boot
- **数据库**: MySQL 8.0+ / PostgreSQL 14+
- **缓存**: Redis 6.0+
- **消息队列**: RabbitMQ / Apache Kafka
- **文件存储**: MinIO / 阿里云OSS
- **实时通信**: Socket.IO / WebRTC SFU
- **容器化**: Docker + Kubernetes

#### 1.3.3 系统架构图
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Web客户端     │    │   移动端App     │    │   大屏显示端    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
         ┌─────────────────────────────────────────────────┐
         │              负载均衡器 (Nginx)                  │
         └─────────────────────────────────────────────────┘
                                 │
         ┌─────────────────────────────────────────────────┐
         │              API网关服务                        │
         └─────────────────────────────────────────────────┘
                                 │
    ┌────────────┬────────────────┼────────────────┬────────────┐
    │            │                │                │            │
┌───▼───┐   ┌───▼───┐       ┌───▼───┐       ┌───▼───┐   ┌───▼───┐
│用户服务│   │调度服务│       │会商服务│       │录像服务│   │通知服务│
└───────┘   └───────┘       └───────┘       └───────┘   └───────┘
    │            │                │                │            │
    └────────────┼────────────────┼────────────────┼────────────┘
                 │                │                │
         ┌─────────────────────────────────────────────────┐
         │              数据存储层                          │
         │  ┌─────────┐  ┌─────────┐  ┌─────────┐         │
         │  │  MySQL  │  │  Redis  │  │  MinIO  │         │
         │  └─────────┘  └─────────┘  └─────────┘         │
         └─────────────────────────────────────────────────┘
```

## 2. 功能需求

### 2.1 用户认证与权限管理

#### 2.1.1 登录系统
- **功能描述**: 用户通过用户名、密码和验证码进行身份认证
- **核心特性**:
  - 用户名密码验证（当前支持：admin/123456）
  - 图形验证码防护
  - 记住密码功能
  - 登录状态持久化
  - 自动重定向到目标页面

#### 2.1.2 权限控制
- **功能描述**: 基于角色的访问控制系统
- **核心特性**:
  - 路由级权限控制
  - 页面访问权限验证
  - 用户角色管理
  - 会话状态管理

### 2.2 调度管理模块

#### 2.2.1 音频调度
- **功能描述**: 实现多种音频通信调度模式，支持各类音频设备的统一管理和调度
- **核心特性**:
  - **设备管理**:
    - 支持对讲机、电台、电话、IP话机等多种设备类型
    - 设备状态实时监控（在线/离线/忙碌/故障）
    - 设备分组管理和层级结构
    - 设备参数配置和远程控制
  - **通话模式**:
    - **单呼**: 一对一通话，支持强插强拆
    - **组呼**: 一对多群组通话，支持动态成员管理
    - **动态组呼**: 临时组建的群组通话，可实时添加/移除成员
    - **混合组呼**: 多个群组间的通话，支持跨组通信
    - **紧急呼叫**: 优先级最高的紧急通信，自动抢占信道
    - **广播呼叫**: 向所有设备或指定区域广播
  - **话权控制**:
    - 实时话权分配和管理
    - 话权申请和释放机制
    - 强制话权控制
    - 话权优先级管理
  - **音频控制**:
    - 独立的音量调节和静音功能
    - 音频增益自动调节
    - 噪声抑制和回声消除
    - 音频编解码优化
  - **通话记录**:
    - 完整的通话历史记录
    - 通话统计和分析报表
    - 通话质量评估
    - 异常通话告警
  - **录音功能**:
    - 通话过程自动录音存储
    - 录音文件管理和检索
    - 录音质量控制
    - 录音文件加密存储

#### 2.2.1.1 音频调度界面功能
- **设备树**: 分层级显示所有音频设备，支持搜索和筛选
- **通话控制面板**: 提供呼叫、接听、挂断、静音等操作按钮
- **通话状态显示**: 实时显示当前通话状态和参与者信息
- **音量控制**: 主音量和各设备独立音量控制
- **录音控制**: 录音开始/停止/暂停控制
- **紧急呼叫**: 一键紧急呼叫功能
- **通话历史**: 显示最近通话记录和快速重拨

#### 2.2.2 视频调度
- **功能描述**: 多画面视频监控和调度系统，支持多路视频流的统一管理和显示
- **核心特性**:
  - **多视图布局**:
    - 支持1、4、9画面等多种布局模式
    - 自定义画面布局和尺寸调整
    - 画面拖拽排列和位置交换
    - 全屏显示和画中画功能
  - **设备树管理**:
    - 分层级的设备组织结构（公司-部门-设备）
    - 设备分组和标签管理
    - 设备搜索和快速定位
    - 设备收藏和常用设备管理
  - **实时视频流**:
    - 支持多路视频流同时显示
    - 视频流自动适配和缩放
    - 视频质量自动调节
    - 网络自适应码率控制
  - **视频控制**:
    - 云台控制（上下左右、变焦、聚焦）
    - 预置位设置和调用
    - 视频参数调节（亮度、对比度、饱和度）
    - 视频截图和抓拍功能
  - **设备状态监控**:
    - 实时显示设备在线状态
    - 设备故障告警和通知
    - 设备性能监控
    - 网络连接质量监控
  - **视频录制**:
    - 支持单路或多路视频流录制
    - 录制计划和定时录制
    - 录制文件自动存储和管理
    - 录制质量和格式配置

#### 2.2.2.1 视频调度界面功能
- **设备树面板**: 左侧设备树，支持展开/折叠和搜索
- **视频显示区**: 中央多画面视频显示区域
- **控制面板**: 底部视频控制按钮和状态信息
- **布局切换**: 快速切换不同画面布局模式
- **设备信息**: 显示当前选中设备的详细信息
- **录制控制**: 录制开始/停止/暂停控制面板

#### 2.2.3 视频录像管理
- **功能描述**: 视频录像的查询、播放、管理和存储系统
- **核心特性**:
  - **多条件查询**:
    - 按公司、部门、设备类型、设备ID查询
    - 按时间范围（开始时间-结束时间）查询
    - 按录像类型（手动录制/自动录制/报警录制）查询
    - 按文件大小和时长筛选
    - 支持模糊搜索和精确匹配
  - **录像列表管理**:
    - 分页显示录像文件列表
    - 列表排序（按时间、大小、时长）
    - 录像文件详细信息显示
    - 录像缩略图预览
    - 录像状态标识（正常/损坏/缺失）
  - **在线播放功能**:
    - 内置HTML5视频播放器
    - 支持多种视频格式（MP4、AVI、MOV等）
    - 播放速度控制（0.5x-2x）
    - 全屏播放和画中画模式
    - 播放历史记录
  - **播放控制**:
    - 播放进度条和时间显示
    - 快进/快退/暂停/停止控制
    - 帧进/帧退精确控制
    - 播放音量控制
    - 播放标记和书签功能
  - **文件操作**:
    - 录像文件下载（支持断点续传）
    - 录像文件删除（支持批量删除）
    - 录像文件备份和归档
    - 录像文件格式转换
    - 录像文件分享和导出
  - **存储管理**:
    - 存储空间监控和告警
    - 录像文件自动清理策略
    - 录像文件压缩和优化
    - 分布式存储支持
    - 存储备份和恢复

#### 2.2.3.1 录像管理界面功能
- **查询条件面板**: 顶部多条件查询表单
- **录像列表**: 中央录像文件列表显示区
- **播放器**: 右侧视频播放器和控制面板
- **操作工具栏**: 批量操作和文件管理工具
- **存储信息**: 显示存储使用情况和统计信息

#### 2.2.4 视频会商系统
- **功能描述**: 多方视频会议和协作系统，支持远程会商和协同决策
- **核心特性**:
  - **会议管理**:
    - 会议创建、编辑、删除
    - 会议计划和定时会议
    - 会议模板和快速创建
    - 会议权限和访问控制
    - 会议状态管理（进行中/已结束/已取消）
  - **成员管理**:
    - 成员邀请（内部用户/外部用户）
    - 成员权限控制（主持人/参会者/观察者）
    - 成员踢出和禁入功能
    - 成员状态监控（在线/离线/发言中）
    - 成员列表和信息显示
  - **音视频控制**:
    - 摄像头开启/关闭控制
    - 麦克风静音/解除静音
    - 扬声器音量控制
    - 视频质量调节
    - 音视频设备切换
  - **会议功能**:
    - 屏幕共享和应用共享
    - 电子白板和标注功能
    - 文件共享和传输
    - 会议纪要和记录
    - 投票和决策功能
  - **实时通信**:
    - 文字聊天和表情包
    - 私聊和群聊功能
    - 消息历史记录
    - 文件传输和下载
    - 实时状态同步
  - **会议录制**:
    - 会议全程录制
    - 录制文件自动存储
    - 录制权限控制
    - 录制文件分享
    - 录制质量配置

#### 2.2.4.1 视频会商界面功能
- **会议列表**: 左侧会议列表，显示进行中和历史会议
- **主视频区**: 中央主要视频显示区域
- **成员列表**: 右侧成员列表和状态显示
- **控制面板**: 底部音视频控制和会议操作
- **聊天面板**: 右侧聊天消息和文件共享
- **会议信息**: 显示会议主题、时间、参会人数等信息
#### 2.2.5 位置调度
- **功能描述**: 位置调度：作为应急指挥融合通信平台的核心功能模块，该模块具备全面的位置管理与调度能力，可实现对各类接入终端（如应急指挥车、救援人员手持终端、无人机、物资运输设备等）的全生命周期位置管控。具体包括：​
实时位置动态呈现：通过高精度地图可视化界面，实时显示所有终端的当前位置、运行状态（如在线 / 离线、移动速度、设备电量等），支持多图层叠加展示，便于指挥中心直观掌握全局资源分布；​
历史位置数据追溯：自动记录终端的历史位置信息，形成可查询的位置数据库，支持按时间、终端类型、区域等多维度筛选，精准还原终端的移动路径与停留轨迹；​
历史轨迹深度查询：提供轨迹回放功能，可动态展示指定终端在某一时间段内的运动轨迹，支持速度标注、关键节点标记（如任务执行点、异常停留点），为事后复盘、责任追溯提供数据支撑；​
终端位置智能订阅：支持指挥人员对重点终端或特定区域的终端进行位置订阅，当终端进入 / 离开预设区域、位置发生异常变动或超出规定范围时，自动触发提醒（如弹窗、声光告警），确保指挥人员及时掌握关键动态。
#### 2.2.5 设备轨迹系统
- **功能描述**: 终端设备轨迹回放和分析系统，提供设备移动轨迹的可视化展示和历史回溯功能
- **核心特性**:
  - **轨迹回放功能**:
    - 动态展示指定终端在某一时间段内的运动轨迹
    - 支持轨迹播放速度调节（0.5x-5x）
    - 轨迹播放进度控制（播放/暂停/快进/快退）
    - 轨迹时间轴显示和时间点跳转
    - 轨迹路径平滑处理和优化显示
  - **速度标注功能**:
    - 实时显示设备移动速度
    - 速度变化趋势图表展示
    - 超速告警和异常速度标记
    - 平均速度和最高速度统计
    - 速度分段颜色标识
  - **关键节点标记**:
    - **任务执行点**: 标记设备执行任务的关键位置
    - **异常停留点**: 识别和标记设备异常停留的位置
    - **重要事件点**: 标记发生重要事件的时间和位置
    - **检查点通过**: 标记设备通过预设检查点的记录
    - **自定义标记**: 支持用户自定义添加重要节点标记
  - **多维度筛选**:
    - **时间筛选**: 按日期范围、时间段筛选轨迹数据
    - **终端类型筛选**: 按设备类型（车辆/人员/设备）筛选
    - **区域筛选**: 按地理区域、行政区划筛选
    - **状态筛选**: 按设备状态（在线/离线/报警）筛选
    - **任务筛选**: 按执行任务类型筛选轨迹
  - **轨迹分析功能**:
    - 移动距离统计和路径分析
    - 停留时间分析和热力图展示
    - 活动区域分析和范围统计
    - 轨迹相似度比较和模式识别
    - 异常轨迹检测和告警
  - **数据支撑功能**:
    - **事后复盘**: 提供详细的轨迹数据用于事件复盘分析
    - **责任追溯**: 通过轨迹数据追溯责任人的行动轨迹
    - **效率评估**: 分析设备/人员的工作效率和路径优化
    - **合规检查**: 检查设备是否按规定路线和时间执行任务
    - **应急响应**: 分析应急事件中各终端的响应轨迹

#### 2.2.5.1 设备轨迹界面功能
- **设备选择面板**: 左侧设备树，支持多选和批量操作
- **地图显示区**: 中央地图区域，显示轨迹路径和关键节点
- **时间控制面板**: 底部时间轴和播放控制器
- **筛选条件面板**: 顶部多维度筛选条件设置
- **轨迹信息面板**: 右侧显示轨迹详细信息和统计数据
- **节点详情面板**: 显示选中节点的详细信息和相关事件
- **分析报告面板**: 轨迹分析结果和统计图表展示

### 2.3 应急指挥大屏
- **功能描述**: 专为指挥中心设计的大屏可视化展示系统
- **核心特性**:
  - **实时态势展示**:
    - 地图态势显示和标注
    - 实时事件分布和统计
    - 资源部署和调度状态
    - 关键指标和KPI展示
  - **多媒体融合**:
    - 视频监控画面集成
    - 音频调度状态显示
    - 会商会议状态展示
    - 应急预案和流程显示
  - **数据可视化**:
    - 图表和统计分析
    - 趋势分析和预测
    - 告警和异常显示
    - 历史数据回顾
  - **交互控制**:
    - 触摸屏操作支持
    - 远程控制功能
    - 多屏联动显示
    - 自定义布局配置
### 2.4 位置调度
主要针对的是大屏模式，可以获取监控、无人机、单兵、手持终端的GIS位置信息，在地图上实时显示终端的当前位置和状态，进行位置跟踪，对指定终端进行历史移动轨迹回放。 
1.支持公网终端、视频监控终端等实时上报GIS定位信息，并在位置调度大屏进行GIS定位显示。 
2.采用 Leaflet 地图库； 
3.可选择一个终端进行点对点业务以完成单点调度需求。可执行的点对点业务有：点呼、语音呼叫、视频监控、视频点呼、轨迹跟踪、轨迹回放；  
4.支持在GIS地图上对选定的终端进行轨迹跟踪，并实时显示终端轨迹的功能； 
5.支持提供地图基本操作功能，包括：图层切换、拖动、放大和缩小、地图复位、测距、测面积； 
### 2.4 系统管理模块

#### 2.4.1 用户管理
- **功能描述**: 系统用户的创建、编辑和管理
- **核心特性**:
  - **用户信息管理**:
    - 用户基本信息维护
    - 用户头像和个人资料
    - 用户组织架构关联
    - 用户联系方式管理
  - **用户状态控制**:
    - 用户启用/禁用状态
    - 用户登录状态监控
    - 用户在线时长统计
    - 用户行为审计
  - **密码安全**:
    - 密码强度策略
    - 密码重置功能
    - 密码过期提醒
    - 登录失败锁定
  - **权限分配**:
    - 用户角色分配
    - 功能权限授权
    - 数据权限控制
    - 权限变更审批

#### 2.4.2 角色管理
- **功能描述**: 系统角色的定义和权限配置
- **核心特性**:
  - **角色定义**:
    - 角色创建和编辑
    - 角色描述和说明
    - 角色分类和标签
    - 角色状态管理
  - **权限配置**:
    - 功能权限分配
    - 菜单访问权限
    - 操作权限控制
    - 数据范围权限
  - **角色关系**:
    - 角色继承关系
    - 角色组合和叠加
    - 角色冲突检测
    - 角色依赖分析
  - **用户关联**:
    - 角色用户分配
    - 批量用户操作
    - 角色变更通知
    - 权限生效时间

#### 2.4.3 权限管理
- **功能描述**: 细粒度的权限控制和管理
- **核心特性**:
  - **权限定义**:
    - 功能权限定义
    - 资源权限配置
    - 操作权限设置
    - 权限分类管理
  - **权限控制**:
    - 基于角色的访问控制(RBAC)
    - 基于属性的访问控制(ABAC)
    - 动态权限验证
    - 权限缓存机制
  - **权限审计**:
    - 权限变更日志
    - 权限使用统计
    - 异常权限告警
    - 权限合规检查

#### 2.4.4 设备管理
- **功能描述**: 系统接入设备的统一管理
- **核心特性**:
  - **设备注册**:
    - 设备自动发现和注册
    - 设备手动添加和配置
    - 设备认证和授权
    - 设备分组和分类
  - **设备监控**:
    - 设备状态实时监控
    - 设备性能指标采集
    - 设备故障告警
    - 设备维护提醒
  - **设备配置**:
    - 设备参数远程配置
    - 设备固件升级
    - 设备重启和重置
    - 设备备份和恢复

### 2.5 个人中心
- **功能描述**: 用户个人信息和偏好设置
- **核心特性**:
  - **个人信息**:
    - 基本信息修改
    - 头像上传和更换
    - 联系方式更新
    - 个人签名设置
  - **安全设置**:
    - 密码修改
    - 安全问题设置
    - 登录设备管理
    - 操作日志查看
  - **偏好设置**:
    - 界面主题选择
    - 语言和时区设置
    - 通知偏好配置
    - 快捷键自定义
  - **操作历史**:
    - 登录历史记录
    - 操作行为记录
    - 文件访问记录
    - 系统使用统计

### 2.6 系统设置
- **功能描述**: 系统级配置和参数管理
- **核心特性**:
  - **基础配置**:
    - 系统基本信息设置
    - 系统参数配置
    - 系统时间和时区
    - 系统日志配置
  - **网络配置**:
    - 网络接口配置
    - 防火墙规则设置
    - 代理服务器配置
    - 网络监控设置
  - **存储配置**:
    - 存储路径设置
    - 存储空间管理
    - 备份策略配置
    - 清理策略设置
  - **安全配置**:
    - 安全策略设置
    - 加密算法配置
    - 证书管理
    - 安全审计配置

## 3. 数据模型设计

### 3.1 用户相关数据模型

#### 3.1.1 用户信息
```typescript
interface User {
  id: string;                    // 用户唯一标识
  username: string;              // 用户名
  realName: string;              // 真实姓名
  email?: string;                // 邮箱地址
  phone?: string;                // 手机号码
  avatar?: string;               // 头像URL
  department?: string;           // 所属部门
  position?: string;             // 职位
  roles: string[];               // 用户角色列表
  permissions: string[];         // 用户权限列表
  status: 'active' | 'inactive' | 'locked'; // 用户状态
  lastLoginTime?: Date;          // 最后登录时间
  createdAt: Date;               // 创建时间
  updatedAt: Date;               // 更新时间
}
```

#### 3.1.2 角色信息
```typescript
interface Role {
  id: string;                    // 角色唯一标识
  name: string;                  // 角色名称
  description?: string;          // 角色描述
  permissions: string[];         // 角色权限列表
  parentRoleId?: string;         // 父角色ID
  level: number;                 // 角色层级
  status: 'active' | 'inactive'; // 角色状态
  createdAt: Date;               // 创建时间
  updatedAt: Date;               // 更新时间
}
```

### 3.2 设备相关数据模型

#### 3.2.1 调度设备
```typescript
interface DispatchDevice {
  id: string;                    // 设备唯一标识
  name: string;                  // 设备名称
  type: 'intercom' | 'radio' | 'phone' | 'ip_phone' | 'mobile' | 'other'; // 设备类型
  model?: string;                // 设备型号
  manufacturer?: string;         // 设备厂商
  serialNumber?: string;         // 设备序列号
  ipAddress?: string;            // 设备IP地址
  port?: number;                 // 设备端口
  status: 'online' | 'offline' | 'busy' | 'fault'; // 设备状态
  groupId?: string;              // 所属组ID
  groupName?: string;            // 所属组名称
  location?: string;             // 设备位置
  coordinates?: {                // 设备坐标
    latitude: number;
    longitude: number;
  };
  capabilities: string[];        // 设备能力列表
  configuration: Record<string, any>; // 设备配置参数
  lastHeartbeat?: Date;          // 最后心跳时间
  createdAt: Date;               // 创建时间
  updatedAt: Date;               // 更新时间
}
```

#### 3.2.2 视频设备
```typescript
interface VideoDevice {
  id: string;                    // 设备唯一标识
  name: string;                  // 设备名称
  type: 'camera' | 'nvr' | 'dvr' | 'encoder'; // 设备类型
  brand: string;                 // 设备品牌
  model: string;                 // 设备型号
  streamUrl: string;             // 视频流地址
  rtmpUrl?: string;              // RTMP流地址
  webrtcUrl?: string;            // WebRTC流地址
  resolution: string;            // 视频分辨率
  frameRate: number;             // 帧率
  bitRate: number;               // 码率
  status: 'online' | 'offline' | 'recording' | 'fault'; // 设备状态
  ptzSupport: boolean;           // 是否支持云台控制
  audioSupport: boolean;         // 是否支持音频
  location: string;              // 设备位置
  coordinates?: {                // 设备坐标
    latitude: number;
    longitude: number;
  };
  groupId: string;               // 所属组ID
  groupName: string;             // 所属组名称
  createdAt: Date;               // 创建时间
  updatedAt: Date;               // 更新时间
}
```

### 3.3 通信记录数据模型

#### 3.3.1 通话记录
```typescript
interface CallRecord {
  id: string;                    // 记录唯一标识
  type: 'individual' | 'group' | 'dynamic' | 'mixed' | 'emergency' | 'broadcast'; // 通话类型
  caller: string;                // 主叫方ID
  callerName: string;            // 主叫方名称
  receivers: string[];           // 被叫方ID列表
  receiverNames: string[];       // 被叫方名称列表
  groupId?: string;              // 群组ID
  groupName?: string;            // 群组名称
  startTime: Date;               // 开始时间
  endTime?: Date;                // 结束时间
  duration?: number;             // 通话时长(秒)
  status: 'ongoing' | 'completed' | 'failed' | 'cancelled'; // 通话状态
  quality: 'excellent' | 'good' | 'fair' | 'poor'; // 通话质量
  hasRecording: boolean;         // 是否有录音
  recordingUrl?: string;         // 录音文件URL
  recordingSize?: number;        // 录音文件大小
  priority: 'low' | 'normal' | 'high' | 'emergency'; // 优先级
  createdAt: Date;               // 创建时间
}
```

#### 3.3.2 会议记录
```typescript
interface MeetingRecord {
  id: string;                    // 会议唯一标识
  topic: string;                 // 会议主题
  description?: string;          // 会议描述
  hostId: string;                // 主持人ID
  hostName: string;              // 主持人姓名
  members: MeetingMember[];      // 会议成员列表
  startTime: Date;               // 开始时间
  endTime?: Date;                // 结束时间
  duration?: number;             // 会议时长(秒)
  status: 'scheduled' | 'ongoing' | 'completed' | 'cancelled'; // 会议状态
  type: 'video' | 'audio' | 'mixed'; // 会议类型
  hasRecording: boolean;         // 是否有录制
  recordingUrl?: string;         // 录制文件URL
  recordingSize?: number;        // 录制文件大小
  maxMembers: number;            // 最大成员数
  isPublic: boolean;             // 是否公开会议
  password?: string;             // 会议密码
  createdAt: Date;               // 创建时间
  updatedAt: Date;               // 更新时间
}

interface MeetingMember {
  id: string;                    // 成员ID
  name: string;                  // 成员姓名
  role: 'host' | 'participant' | 'observer'; // 成员角色
  status: 'online' | 'offline' | 'speaking' | 'muted'; // 成员状态
  joinTime?: Date;               // 加入时间
  leaveTime?: Date;              // 离开时间
  duration?: number;             // 参会时长
  isMuted: boolean;              // 是否静音
  isCameraOn: boolean;           // 是否开启摄像头
}
```

### 3.4 录像文件数据模型

```typescript
interface VideoRecording {
  id: string;                    // 录像唯一标识
  deviceId: string;              // 设备ID
  deviceName: string;            // 设备名称
  deviceType: string;            // 设备类型
  fileName: string;              // 文件名
  filePath: string;              // 文件路径
  fileUrl: string;               // 文件访问URL
  fileSize: number;              // 文件大小(字节)
  duration: number;              // 录像时长(秒)
  resolution: string;            // 视频分辨率
  frameRate: number;             // 帧率
  bitRate: number;               // 码率
  format: string;                // 文件格式
  startTime: Date;               // 录像开始时间
  endTime: Date;                 // 录像结束时间
  recordType: 'manual' | 'scheduled' | 'alarm' | 'motion'; // 录制类型
  status: 'recording' | 'completed' | 'failed' | 'corrupted'; // 录像状态
  thumbnailUrl?: string;         // 缩略图URL
  tags: string[];                // 标签列表
  description?: string;          // 录像描述
  isProtected: boolean;          // 是否受保护
  retentionDays: number;         // 保留天数
  createdAt: Date;               // 创建时间
  updatedAt: Date;               // 更新时间
}
```

### 3.5 设备轨迹数据模型

#### 3.5.1 轨迹记录
```typescript
interface TrajectoryRecord {
  id: string;                    // 轨迹记录唯一标识
  deviceId: string;              // 设备ID
  deviceName: string;            // 设备名称
  deviceType: 'vehicle' | 'personnel' | 'equipment' | 'mobile'; // 设备类型
  trajectoryPoints: TrajectoryPoint[]; // 轨迹点列表
  startTime: Date;               // 轨迹开始时间
  endTime: Date;                 // 轨迹结束时间
  duration: number;              // 轨迹总时长(秒)
  totalDistance: number;         // 总移动距离(米)
  averageSpeed: number;          // 平均速度(km/h)
  maxSpeed: number;              // 最高速度(km/h)
  keyNodes: TrajectoryKeyNode[]; // 关键节点列表
  tags: string[];                // 轨迹标签
  taskId?: string;               // 关联任务ID
  taskType?: string;             // 任务类型
  status: 'active' | 'completed' | 'interrupted'; // 轨迹状态
  createdAt: Date;               // 创建时间
  updatedAt: Date;               // 更新时间
}
```

#### 3.5.2 轨迹点
```typescript
interface TrajectoryPoint {
  id: string;                    // 轨迹点唯一标识
  trajectoryId: string;          // 所属轨迹ID
  latitude: number;              // 纬度
  longitude: number;             // 经度
  altitude?: number;             // 海拔高度(米)
  accuracy?: number;             // 定位精度(米)
  speed: number;                 // 当前速度(km/h)
  direction?: number;            // 移动方向(度)
  timestamp: Date;               // 时间戳
  address?: string;              // 地址信息
  isKeyPoint: boolean;           // 是否为关键点
  eventType?: 'start' | 'stop' | 'pause' | 'resume' | 'checkpoint' | 'alarm'; // 事件类型
  description?: string;          // 描述信息
}
```

#### 3.5.3 关键节点
```typescript
interface TrajectoryKeyNode {
  id: string;                    // 节点唯一标识
  trajectoryId: string;          // 所属轨迹ID
  pointId: string;               // 关联轨迹点ID
  nodeType: 'task_execution' | 'abnormal_stay' | 'important_event' | 'checkpoint' | 'custom'; // 节点类型
  title: string;                 // 节点标题
  description: string;           // 节点描述
  latitude: number;              // 纬度
  longitude: number;             // 经度
  timestamp: Date;               // 发生时间
  duration?: number;             // 停留时长(秒)
  priority: 'low' | 'normal' | 'high' | 'critical'; // 优先级
  status: 'normal' | 'warning' | 'error'; // 状态
  relatedEvents: string[];       // 关联事件ID列表
  attachments: NodeAttachment[]; // 附件列表
  createdBy: string;             // 创建人
  createdAt: Date;               // 创建时间
}
```

#### 3.5.4 节点附件
```typescript
interface NodeAttachment {
  id: string;                    // 附件唯一标识
  nodeId: string;                // 所属节点ID
  type: 'image' | 'video' | 'audio' | 'document'; // 附件类型
  fileName: string;              // 文件名
  fileUrl: string;               // 文件URL
  fileSize: number;              // 文件大小(字节)
  mimeType: string;              // MIME类型
  description?: string;          // 附件描述
  uploadedBy: string;            // 上传人
  uploadedAt: Date;              // 上传时间
}
```

#### 3.5.5 轨迹分析结果
```typescript
interface TrajectoryAnalysis {
  id: string;                    // 分析结果唯一标识
  trajectoryId: string;          // 轨迹ID
  analysisType: 'efficiency' | 'compliance' | 'anomaly' | 'pattern'; // 分析类型
  result: {
    score: number;               // 评分(0-100)
    summary: string;             // 分析摘要
    details: AnalysisDetail[];   // 详细分析结果
    recommendations: string[];   // 改进建议
  };
  parameters: Record<string, any>; // 分析参数
  executedAt: Date;              // 执行时间
  executedBy: string;            // 执行人
}

interface AnalysisDetail {
  metric: string;                // 指标名称
  value: number;                 // 指标值
  unit: string;                  // 单位
  status: 'good' | 'warning' | 'poor'; // 状态
  description: string;           // 描述
}
```

## 4. 用户界面设计

### 4.1 整体布局
- **顶部导航栏**: 系统标题、面包屑导航、用户信息、通知中心
- **左侧菜单栏**: 功能模块导航，支持折叠展开
- **主内容区**: 各功能模块的具体内容展示
- **响应式设计**: 适配不同屏幕尺寸

### 4.2 主题风格
- **设计语言**: 现代化扁平设计风格
- **色彩方案**: 以蓝色为主色调的专业配色
- **交互反馈**: 丰富的动画效果和状态反馈
- **可访问性**: 符合Web可访问性标准

## 5. 性能要求

### 5.1 响应时间
- 页面加载时间 < 3秒
- 用户操作响应时间 < 1秒
- 视频流延迟 < 500ms
- 音频通话延迟 < 200ms

### 5.2 并发能力
- 支持100+并发用户
- 支持50+同时音频通话
- 支持20+同时视频会商
- 支持1000+设备接入

### 5.3 可用性
- 系统可用性 ≥ 99.5%
- 故障恢复时间 < 30分钟
- 数据备份和恢复机制
- 负载均衡和容错处理

## 6. 安全要求

### 6.1 身份认证
- 强密码策略
- 会话超时控制
- 多因素认证支持
- 防暴力破解机制

### 6.2 数据安全
- 数据传输加密
- 敏感数据脱敏
- 访问日志记录
- 数据备份加密

### 6.3 网络安全
- HTTPS协议支持
- XSS和CSRF防护
- SQL注入防护
- 网络访问控制

## 7. 部署要求

### 7.1 运行环境
- **操作系统**: Linux/Windows Server
- **Web服务器**: Nginx/Apache
- **数据库**: MySQL/PostgreSQL
- **Node.js**: 版本 ≥ 16.0

### 7.2 硬件要求
- **CPU**: 4核心以上
- **内存**: 8GB以上
- **存储**: 500GB以上
- **网络**: 千兆网络接口

### 7.3 浏览器兼容性
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## 8. 维护和支持

### 8.1 系统监控
- 实时性能监控
- 错误日志收集
- 用户行为分析
- 系统健康检查

### 8.2 更新维护
- 定期安全更新
- 功能迭代升级
- 数据库维护
- 系统优化调整

### 8.3 技术支持
- 7×24小时技术支持
- 远程故障诊断
- 现场技术服务
- 用户培训服务

## 9. 项目实施计划

### 9.1 开发阶段规划

#### 第一阶段：基础框架搭建（2周）
- 项目初始化和环境搭建
- 基础UI框架和组件库集成
- 用户认证和权限管理模块
- 基础路由和页面结构

#### 第二阶段：核心功能开发（6周）
- 音频调度模块开发
- 视频调度模块开发
- 视频录像管理模块
- 视频会商系统开发

#### 第三阶段：系统管理功能（3周）
- 用户管理和角色权限
- 设备管理和配置
- 系统设置和参数配置
- 应急指挥大屏开发

#### 第四阶段：测试和优化（3周）
- 功能测试和性能测试
- 安全测试和压力测试
- 用户体验优化
- 文档编写和培训材料

#### 第五阶段：部署和上线（2周）
- 生产环境部署
- 数据迁移和初始化
- 用户培训和系统交付
- 运维监控和技术支持

### 9.2 技术风险评估

#### 高风险项
- **WebRTC兼容性**: 不同浏览器的WebRTC实现差异
- **大并发处理**: 高并发音视频流处理性能
- **网络稳定性**: 网络不稳定对实时通信的影响

#### 中风险项
- **设备兼容性**: 不同厂商设备的接入适配
- **数据安全性**: 敏感数据的加密和传输安全
- **系统集成**: 与现有系统的集成复杂度

#### 低风险项
- **界面适配**: 不同屏幕尺寸的界面适配
- **功能扩展**: 后续功能模块的扩展开发
- **维护升级**: 系统的日常维护和版本升级

### 9.3 质量保证措施

#### 代码质量
- 代码审查和静态分析
- 单元测试覆盖率≥80%
- 集成测试和端到端测试
- 代码规范和文档标准

#### 性能保证
- 性能基准测试
- 负载测试和压力测试
- 内存泄漏检测
- 网络优化和缓存策略

#### 安全保证
- 安全代码审查
- 漏洞扫描和渗透测试
- 数据加密和传输安全
- 访问控制和权限验证

## 10. 运维和监控

### 10.1 系统监控指标

#### 性能指标
- CPU使用率和内存占用
- 网络带宽和延迟
- 数据库连接数和响应时间
- 存储空间使用情况

#### 业务指标
- 用户在线数和并发数
- 通话成功率和质量
- 会议创建数和参与人数
- 录像存储量和播放次数

#### 安全指标
- 登录失败次数和异常访问
- 权限变更和敏感操作
- 系统漏洞和安全事件
- 数据备份和恢复状态

### 10.2 告警和通知

#### 告警级别
- **紧急告警**: 系统宕机、数据丢失等
- **重要告警**: 性能严重下降、安全威胁等
- **一般告警**: 资源使用过高、功能异常等
- **提醒通知**: 定期报告、维护提醒等

#### 通知方式
- 邮件通知和短信告警
- 系统内消息推送
- 第三方监控平台集成
- 移动端App推送

### 10.3 备份和恢复

#### 数据备份策略
- 数据库全量备份（每日）
- 数据库增量备份（每小时）
- 录音录像文件备份（实时）
- 配置文件和代码备份（版本控制）

#### 灾难恢复计划
- 备份数据验证和测试
- 恢复时间目标（RTO）≤4小时
- 恢复点目标（RPO）≤1小时
- 应急响应流程和联系方式

---

## 附录

### 附录A：术语表

| 术语 | 英文 | 说明 |
|------|------|------|
| 应急指挥调度系统 | HDS (Hazard Dispatch System) | 本系统的全称 |
| 单呼 | Individual Call | 一对一通话模式 |
| 组呼 | Group Call | 一对多群组通话模式 |
| 动态组呼 | Dynamic Group Call | 临时组建的群组通话 |
| 混合组呼 | Mixed Group Call | 多个群组间的通话 |
| 紧急呼叫 | Emergency Call | 优先级最高的紧急通信 |
| 话权 | PTT (Push To Talk) | 通话发言权控制 |
| 云台控制 | PTZ Control | 摄像头的平移、倾斜、缩放控制 |
| 会商 | Conference | 多方视频会议和协作 |
| 大屏 | Large Screen | 指挥中心大屏显示系统 |

### 附录B：接口规范

#### B.1 RESTful API规范
- 使用HTTP标准状态码
- 统一的响应数据格式
- API版本控制策略
- 请求和响应数据验证

#### B.2 WebSocket消息格式
```json
{
  "type": "message_type",
  "data": {
    "key": "value"
  },
  "timestamp": "2024-12-01T10:00:00Z",
  "messageId": "unique_message_id"
}
```

#### B.3 WebRTC信令协议
- Offer/Answer交换格式
- ICE候选信息格式
- 媒体协商参数
- 连接状态通知

### 附录C：部署配置示例

#### C.1 Nginx配置示例
```nginx
server {
    listen 80;
    server_name hds.example.com;

    location / {
        root /var/www/hds;
        try_files $uri $uri/ /index.html;
    }

    location /api {
        proxy_pass http://backend:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /ws {
        proxy_pass http://backend:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

#### C.2 Docker Compose配置示例
```yaml
version: '3.8'
services:
  frontend:
    build: .
    ports:
      - "80:80"
    depends_on:
      - backend

  backend:
    image: node:16
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
    depends_on:
      - database

  database:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=password
      - MYSQL_DATABASE=hds
    volumes:
      - mysql_data:/var/lib/mysql

volumes:
  mysql_data:
```

---

**文档版本**: v2.0
**创建日期**: 2024年12月
**最后更新**: 2025年1月
**文档状态**: 正式版
**编写人员**: 系统架构师、产品经理、技术负责人
**审核人员**: 项目经理、技术总监
**批准人员**: 产品总监
